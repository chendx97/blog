(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{311:function(t,s,a){"use strict";a.r(s);var n=a(14),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"为什么要自定义脚手架"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么要自定义脚手架"}},[t._v("#")]),t._v(" 为什么要自定义脚手架？")]),t._v(" "),s("p",[t._v("首先，每次创建项目后都需要很多重复性操作，比如安装UI库、css预处理器。在业务层面，每次也要添加一些必备的功能，比如登录、404页面等。其次，可以锻炼自己的技术。")]),t._v(" "),s("h1",{attrs:{id:"脚手架的功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#脚手架的功能"}},[t._v("#")]),t._v(" 脚手架的功能")]),t._v(" "),s("p",[t._v("脚手架创建项目的流程：")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("让用户选择模板；")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("根据用户输入填充模板；")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("下载模板文件到创建的新文件夹中；")])])])]),t._v(" "),s("p",[t._v("从框架来看，创建项目的时候需要选择是vue框架还是react框架，以及是否需要添加 typescript。")]),t._v(" "),s("p",[t._v("从插件来看，需要安装UI库、CSS预处理器、路由、全局状态管理器。")]),t._v(" "),s("p",[t._v("从项目功能来看，还需要封装fetch请求、登录、未登录页面、404页面、部署配置文件。")]),t._v(" "),s("p",[t._v("再参考一下vite，所以我们可以先设置几个模板，然后把小功能填充到模板里面。")]),t._v(" "),s("h1",{attrs:{id:"具体的逻辑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#具体的逻辑"}},[t._v("#")]),t._v(" 具体的逻辑")]),t._v(" "),s("p",[s("strong",[t._v("1.判断远程是否有更新版本，如果有询问用户是否更新。")])]),t._v(" "),s("p",[t._v("当前版本从package.json中获取。")]),t._v(" "),s("p",[t._v("远程版本用"),s("code",[t._v("exec()")]),t._v("获取：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm show xx version'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stdout"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stderr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("2.询问用户想要的功能")])]),t._v(" "),s("p",[t._v("用"),s("code",[t._v("inquirer")]),t._v("库。")]),t._v(" "),s("p",[t._v("询问项目名、框架、是否添加 typescript、是否添加 electron 和 是否添加登录")]),t._v(" "),s("p",[s("strong",[t._v("3.拉取模板，拷贝模板到当前项目。")])]),t._v(" "),s("p",[t._v("模板就是完整的最基础的项目，如果是必需的功能就直接加进去，如果需要用户选择是否添加则把该功能所在文件改为"),s("strong",[t._v("ejs")]),t._v("文件。")]),t._v(" "),s("p",[t._v("在拷贝中判断文件是否是ejs文件，如果是则把用户的选择都传进去。")]),t._v(" "),s("p",[t._v("如果已经有同名项目，则在项目名后加（n）。")]),t._v(" "),s("p",[s("em",[t._v("注：拷贝的时候模板需要用相对路径获取。")])]),t._v(" "),s("p",[s("em",[t._v("可以用ora库添加loading。")])]),t._v(" "),s("h1",{attrs:{id:"可能遇到的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#可能遇到的问题"}},[t._v("#")]),t._v(" 可能遇到的问题")]),t._v(" "),s("p",[s("strong",[t._v("1.npm create命令")])]),t._v(" "),s("p",[t._v("npm create等价于npm init")]),t._v(" "),s("p",[t._v("npm init 是新建package.json文件，但 npm create xx 会先安装一个create-xx的包，然后执行这个包中的create-xx命令")]),t._v(" "),s("p",[t._v("通过npm exec create-xx来执行，npm exec可以执行本地或远程包中的命令。")]),t._v(" "),s("p",[t._v("所以，我们可以"),s("strong",[t._v("设置package.json中项目名为xx")]),t._v("，发布脚手架后，用户就可以通过"),s("strong",[t._v("npm create xx")]),t._v("来通过脚手架创建项目。")]),t._v(" "),s("p",[s("strong",[t._v("2.npm link")])]),t._v(" "),s("p",[t._v("可以通过以下命令在本地测试脚手架。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("\nnpm link 将当前目录链接到全局\n\nnpm list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("g "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("depth"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" 查看全局list\n\nnpm unlink "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("g xx 删除，如果是全局一定要加"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("g\n\n")])])]),s("p",[s("strong",[t._v("3.命令无法执行")])]),t._v(" "),s("p",[t._v("bin/xx.js文件开头要加")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token hashbang comment"}},[t._v("#!/usr/bin/env node")]),t._v("\n\n")])])]),s("p",[t._v("script声明命令时，文件需要添加.js后缀")]),t._v(" "),s("p",[s("strong",[t._v("4.ejs条件渲染时留下空行")])]),t._v(" "),s("p",[t._v("<%_ ... _%>是不可行的。需要将开始标签紧贴着前一行，结束标签紧贴着可能显示的行。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("b")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("c")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("5.生成的项目中不包含.ignore文件")])]),t._v(" "),s("p",[t._v("将.ignore重命名为ignore，复制完所有文件后，单独复制ignore文件为.ignore，并删除复制后的ignore")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("copyFileSync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("sourceDir"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("/gitignore")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("targetDir"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("/.gitignore")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlinkSync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("targetDir"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("/gitignore")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("6.引用requirer时报错Error [ERR_REQUIRE_ESM]: require() of ES Module ... from ... is not supported")])]),t._v(" "),s("p",[t._v("降版本，可以降到v8.2.0")])])}),[],!1,null,null,null);s.default=r.exports}}]);