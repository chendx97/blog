(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{320:function(s,t,a){"use strict";a.r(t);var n=a(14),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_1-docker的作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker的作用"}},[s._v("#")]),s._v(" 1.docker的作用")]),s._v(" "),t("p",[s._v("打包、分发、部署"),t("br"),s._v("\n打包：就是把你软件运行所需的依赖、第三方库、软件打包到一起，变成一个安装包；"),t("br"),s._v("\n分发：你可以把你打包好的“安装包”上传到一个镜像仓库，其他人可以非常方便的获取和安装；"),t("br"),s._v("\n部署：拿着“安装包”就可以一个命令运行起来你的应用，自动模拟出一模一样的运行环境，不管是在 Windows/Mac/Linux。")]),s._v(" "),t("h1",{attrs:{id:"_2-docker命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker命令"}},[s._v("#")]),s._v(" 2.docker命令")]),s._v(" "),t("div",{staticClass:"language-docker extra-class"},[t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[s._v("docker build -t test:v1 .     \n")])])]),t("p",[s._v("-t 指定镜像名字和版本号；"),t("br"),s._v("\n. 指在当前目录build，将当前目录作为构建上下文；"),t("br"),s._v("\n参考链接："),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/build/",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker build命令"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-docker extra-class"},[t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[s._v("docker run -dt -p 8089:8089 demo\n")])])]),t("p",[s._v("-p port1:port2 指定端口号，port1要访问的端口号，port2docker内部使用的端口号；"),t("br"),s._v("\n-d 后台运行，-i 以交互模式运行容器，-t为容器重新分配一个伪输入终端，-it在一个新终端里运行容器，-dt在终端的后台运行容器；"),t("br"),s._v("\n参考链接："),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/run/",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker run命令"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("其他常见命令如下所示："),t("br"),s._v("\ndocker ps 查看当前运行中的容器"),t("br"),s._v("\ndocker exec -it  containerid sh  // 进入容器，在容器内可以执行npm run start等命令"),t("br"),s._v("\ndocker images 查看镜像列表"),t("br"),s._v("\ndocker rm container-id 删除指定 id 的容器"),t("br"),s._v("\ndocker stop/start container-id 停止/启动指定 id 的容器"),t("br"),s._v("\ndocker rmi image-id 删除指定 id 的镜像")]),s._v(" "),t("h1",{attrs:{id:"_3-dockerfile文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-dockerfile文件"}},[s._v("#")]),s._v(" 3.Dockerfile文件")]),s._v(" "),t("p",[s._v("文件中命令解释如下所示：")]),s._v(" "),t("div",{staticClass:"language-docker extra-class"},[t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:14-alpine # 指定基础镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app # 指定shell语句运行的目录，如果目录不存在会自动创建")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" a.txt /app/ # 将本地文件拷贝到容器的某目录下")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ADD a.txt /app/ # 拷贝本地或远程文件,可以自动解压缩，还会使构建缓存失效")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm i # 运行shell语句，构建时运行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v("  ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start"')]),s._v("]  # 指定镜像启动运行的脚本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start"')]),s._v("] # 类似CMD  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" <name>  # 指定生成镜像的作者，LABEL更灵活。  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8089 # 暴露镜像在容器内运行的端口号  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PORT=8089 # 指定环境变量，运行时也生效  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v("   # 构建参数，运行时无效，可以构建时候临时修改变量")]),s._v("\n")])])]),t("p",[s._v("教程1：https://docker.easydoc.net/doc/81170005/cCewZWoN/lTKfePfP"),t("br"),s._v("\n教程2：https://www.bilibili.com/video/BV1k7411B7QL/?spm_id_from=333.337.search-card.all.click&vd_source=6452cc89d77d512e999c37668481d36b"),t("br"),s._v("\n教程3：https://yeasy.gitbook.io/docker_practice/appendix/best_practices#dockerfile-zhi-ling")]),s._v(" "),t("h1",{attrs:{id:"_4-dockerfile配置方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-dockerfile配置方案"}},[s._v("#")]),s._v(" 4.dockerfile配置方案")]),s._v(" "),t("p",[s._v("方案1：\n本地打包，然后复制到容器中。")]),s._v(" "),t("div",{staticClass:"language-docker extra-class"},[t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node 启动")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:14-alpine")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" package.json /app/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ./.output /app/.output")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8089")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PORT=8089")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start"')]),s._v("]")]),s._v("\n")])])]),t("div",{staticClass:"language-docker extra-class"},[t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx:alpine")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" /dist /usr/share/nginx/html/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" nginx.conf /etc/nginx/conf.d/nginx.conf")]),s._v("\n")])])]),t("p",[s._v("方案2：把本地整个文件夹复制到容器中，在容器中打包。需要添加.dockerignore文件，避免上传的文件夹比较大。")]),s._v(" "),t("div",{staticClass:"language-docker extra-class"},[t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:14-alpine")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . /app/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" cd /app && yarn && yarn build")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start"')]),s._v("]")]),s._v("\n")])])]),t("div",{staticClass:"language-docker extra-class"},[t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx:alpine")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . /app/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" cd /app && yarn && yarn build")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" /app/dist /usr/share/nginx/html/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" nginx.conf /etc/nginx/conf.d/nginx.conf")]),s._v("\n")])])]),t("p",[s._v("方案1需要在docker build前执行一遍yarn build，"),t("br"),s._v("\n方案2打包出来的镜像比较大。")]),s._v(" "),t("h1",{attrs:{id:"_5-报错解决"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-报错解决"}},[s._v("#")]),s._v(" 5.报错解决")]),s._v(" "),t("p",[s._v("This version of npm is compatible with lockfileVersion@1, but package-lock.json was generated for lockfileVersion@2"),t("br"),s._v("\ndocker版本和本地电脑中node版本不匹配，升级docker中的node，或使用yarn。")]),s._v(" "),t("h1",{attrs:{id:"_6-调试docker-build"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-调试docker-build"}},[s._v("#")]),s._v(" 6.调试docker build")]),s._v(" "),t("p",[s._v("在dockerfile中只设置基础镜像，然后启动，在终端中运行需要的步骤，如果成功就把每个步骤的命令写入dockerfile文件中。")]),s._v(" "),t("div",{staticClass:"language-docker extra-class"},[t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:14-alpine")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tail"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-f"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/null"')]),s._v("]")]),s._v("\n")])])]),t("p",[s._v("进入调试：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" demo "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-dt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8089")]),s._v(":8089 demo\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v("  containerid "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n")])])]),t("p",[s._v("然后可以在终端中执行Dockerfile中想要添加的RUN命令。")]),s._v(" "),t("p",[s._v("调试后关闭容器：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);