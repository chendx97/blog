<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æ²³è±š</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="XXX">
    
    <link rel="preload" href="/blog/assets/css/0.styles.fcd904e3.css" as="style"><link rel="preload" href="/blog/assets/js/app.f0df7f2e.js" as="script"><link rel="preload" href="/blog/assets/js/2.0c4bddf9.js" as="script"><link rel="preload" href="/blog/assets/js/1.50b457b8.js" as="script"><link rel="preload" href="/blog/assets/js/44.01594bf5.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.325b9f09.js"><link rel="prefetch" href="/blog/assets/js/11.845e3692.js"><link rel="prefetch" href="/blog/assets/js/12.ecdb524b.js"><link rel="prefetch" href="/blog/assets/js/13.3f3f6a36.js"><link rel="prefetch" href="/blog/assets/js/14.eb7a3d07.js"><link rel="prefetch" href="/blog/assets/js/15.b60f3925.js"><link rel="prefetch" href="/blog/assets/js/16.85253907.js"><link rel="prefetch" href="/blog/assets/js/17.c2838453.js"><link rel="prefetch" href="/blog/assets/js/18.3256f17f.js"><link rel="prefetch" href="/blog/assets/js/19.d8afd0ae.js"><link rel="prefetch" href="/blog/assets/js/20.10e47ab9.js"><link rel="prefetch" href="/blog/assets/js/21.33b300c9.js"><link rel="prefetch" href="/blog/assets/js/22.2dbf0660.js"><link rel="prefetch" href="/blog/assets/js/23.0b19fb5d.js"><link rel="prefetch" href="/blog/assets/js/24.3826b0a6.js"><link rel="prefetch" href="/blog/assets/js/25.fa38cc5a.js"><link rel="prefetch" href="/blog/assets/js/26.d8946148.js"><link rel="prefetch" href="/blog/assets/js/27.cb829d15.js"><link rel="prefetch" href="/blog/assets/js/28.ed8bb5c5.js"><link rel="prefetch" href="/blog/assets/js/29.d8e41b50.js"><link rel="prefetch" href="/blog/assets/js/3.af33e5d6.js"><link rel="prefetch" href="/blog/assets/js/30.e01a3364.js"><link rel="prefetch" href="/blog/assets/js/31.7c6536dc.js"><link rel="prefetch" href="/blog/assets/js/32.f525454e.js"><link rel="prefetch" href="/blog/assets/js/33.5e2146b5.js"><link rel="prefetch" href="/blog/assets/js/34.cbc96651.js"><link rel="prefetch" href="/blog/assets/js/35.442b37c6.js"><link rel="prefetch" href="/blog/assets/js/36.d0f6e7e5.js"><link rel="prefetch" href="/blog/assets/js/37.c738e4ad.js"><link rel="prefetch" href="/blog/assets/js/38.d610966a.js"><link rel="prefetch" href="/blog/assets/js/39.b75541dc.js"><link rel="prefetch" href="/blog/assets/js/4.45665f8a.js"><link rel="prefetch" href="/blog/assets/js/40.746bbcd9.js"><link rel="prefetch" href="/blog/assets/js/41.bbff594c.js"><link rel="prefetch" href="/blog/assets/js/42.5c88a79e.js"><link rel="prefetch" href="/blog/assets/js/43.25c2e885.js"><link rel="prefetch" href="/blog/assets/js/45.c92c0e59.js"><link rel="prefetch" href="/blog/assets/js/46.80f0728c.js"><link rel="prefetch" href="/blog/assets/js/47.81e82aa9.js"><link rel="prefetch" href="/blog/assets/js/48.15b88b85.js"><link rel="prefetch" href="/blog/assets/js/49.f4700a1b.js"><link rel="prefetch" href="/blog/assets/js/5.7098d77a.js"><link rel="prefetch" href="/blog/assets/js/6.0c0a0f39.js"><link rel="prefetch" href="/blog/assets/js/7.6a854e57.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.77260563.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.fcd904e3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">æ²³è±š</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="https://github.com/chendx97" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="https://github.com/chendx97" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/html/é›¶å®½å­—ç¬¦" class="sidebar-heading clickable"><span>html</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/html/é›¶å®½å­—ç¬¦.html" class="sidebar-link">ä¸€ä¸ªçœ‹èµ·æ¥åªæœ‰2ä¸ªå­—é•¿åº¦å´æœ‰8çš„å­—ç¬¦ä¸²å¼•èµ·çš„bug</a></li><li><a href="/blog/html/canvas-measureText.html" class="sidebar-link">canvasä¹‹measureTextæµ‹é‡æ–‡æœ¬</a></li><li><a href="/blog/html/ç”»æ¿.html" class="sidebar-link">ç”¨canvaså®ç°ä¸€ä¸ªç®€å•çš„ç”»æ¿</a></li><li><a href="/blog/html/åˆ®åˆ®ä¹.html" class="sidebar-link">åˆ®åˆ®ä¹æ•ˆæœåŸæ¥å¦‚æ­¤ç®€å•</a></li><li><a href="/blog/html/is-caps-lock.html" class="sidebar-link">ğŸ”‘è¾“å…¥å¯†ç æ—¶åˆ¤æ–­æ˜¯å¦å¼€å¯å¤§å†™é”å®š</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/css/tailwind-guide" class="sidebar-heading clickable"><span>css</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/css/tailwind-guide.html" class="sidebar-link">tailwindä½¿ç”¨æŒ‡å—</a></li><li><a href="/blog/css/timer.html" class="sidebar-link">ã€ç¿»è¯‘ã€‘å¦‚ä½•å®ç°ä¸€ä¸ªçº¯CSSè®¡æ—¶å™¨</a></li><li><a href="/blog/css/svg-cursor.html" class="sidebar-link">ç»™svgè®¾ç½®cursorä¸ç”Ÿæ•ˆ</a></li><li><a href="/blog/css/menu.html" class="sidebar-link">å¸¸è§çš„hoverèœå•ç¼éš™é—®é¢˜</a></li><li><a href="/blog/css/element-plusè‡ªåŠ¨æŒ‰éœ€å¼•å…¥.html" class="sidebar-link">å®ç°è‡ªåŠ¨å¼•å…¥+æŒ‰éœ€å¼•å…¥element-plusåŸæ¥å¦‚æ­¤ç®€å•</a></li><li><a href="/blog/css/css-var-func.html" class="sidebar-link">ğŸCSSå˜é‡å’ŒCSSå‡½æ•°</a></li><li><a href="/blog/css/text-ellipsis.html" class="sidebar-link">ğŸ§æ–‡æœ¬æº¢å‡º+å®Œæ•´å†…å®¹æç¤º</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/node/post-502" class="sidebar-heading clickable open"><span>node</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/node/post-502.html" class="sidebar-link">ä¸ºä»€ä¹ˆåªè¿™ä¸€ä¸ªæ¥å£502å‘¢ï¼Ÿ</a></li><li><a href="/blog/node/å¼€å‘æ¥å£.html" class="active sidebar-link">ç¬¬ä¸€æ¬¡å¼€å‘nodeæ¥å£-å¹²è´§æ€»ç»“</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/node/å¼€å‘æ¥å£.html#body-parser" class="sidebar-link">body-parser</a></li><li class="sidebar-sub-header"><a href="/blog/node/å¼€å‘æ¥å£.html#cookie-parser" class="sidebar-link">cookie-parser</a></li><li class="sidebar-sub-header"><a href="/blog/node/å¼€å‘æ¥å£.html#æŸ¥" class="sidebar-link">æŸ¥</a></li><li class="sidebar-sub-header"><a href="/blog/node/å¼€å‘æ¥å£.html#å¢" class="sidebar-link">å¢</a></li><li class="sidebar-sub-header"><a href="/blog/node/å¼€å‘æ¥å£.html#åˆ " class="sidebar-link">åˆ </a></li><li class="sidebar-sub-header"><a href="/blog/node/å¼€å‘æ¥å£.html#æ”¹" class="sidebar-link">æ”¹</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/deploy/nginx-autoindex-auth" class="sidebar-heading clickable"><span>deploy</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/deploy/nginx-autoindex-auth.html" class="sidebar-link">ç›®å½•æµè§ˆ&amp;æƒé™æ ¡éªŒ</a></li><li><a href="/blog/deploy/docker-tutorial.html" class="sidebar-link">DockeråŸºç¡€çŸ¥è¯†æ€»ç»“</a></li><li><a href="/blog/deploy/use-cicd-auto-deploy.html" class="sidebar-link">å¦‚ä½•ä½¿ç”¨CICDå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/custom-utils/frame" class="sidebar-heading clickable"><span>è‡ªå®šä¹‰å¼€å‘å·¥å…·</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/custom-utils/frame.html" class="sidebar-link">å®ç°è‡ªå®šä¹‰è„šæ‰‹æ¶</a></li><li><a href="/blog/custom-utils/npm.html" class="sidebar-link">ä»0åˆ°1å®ç°ä¸€ä¸ªnpmåº“</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/git/lfs" class="sidebar-heading clickable"><span>git</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/git/lfs.html" class="sidebar-link">git LFSè§£å†³å¤§æ–‡ä»¶ä¸Šä¼ </a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/source-code/fetch-event-source" class="sidebar-heading clickable"><span>æºç </span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/source-code/fetch-event-source.html" class="sidebar-link">æˆ‘çš„ç¬¬ä¸€ç¯‡æºç é˜…è¯»ä¹‹fetch-event-source</a></li><li><a href="/blog/source-code/virtual-node.html" class="sidebar-link">ã€ç¿»è¯‘ã€‘200è¡ŒJSå®ç°çš„è™šæ‹ŸDOM</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/request/SSE" class="sidebar-heading clickable"><span>æ¥å£è¯·æ±‚</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/request/SSE.html" class="sidebar-link">æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€æ¶ˆæ¯Server-client events(SSE)</a></li><li><a href="/blog/request/å¦‚ä½•åˆ¤æ–­æ¥å£æ˜¯å¦åœ¨è®¾å®šæ—¶é—´å†…è¿”å›.html" class="sidebar-link">å¦‚ä½•åˆ¤æ–­æ¥å£æ˜¯å¦åœ¨è®¾å®šæ—¶é—´å†…è¿”å›</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/npm/could-not-determine-executable-to-run" class="sidebar-heading clickable"><span>npm</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/npm/npm error--could not determine executable to run.html" class="sidebar-link">could not determine executable to run</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/" class="sidebar-heading clickable router-link-active"><span>æ¬¢è¿å­¦ä¹ </span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/" aria-current="page" class="sidebar-link">åšå®¢ç®€ä»‹</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/handbook/1" class="sidebar-heading clickable"><span>åŸºç¡€ç¯‡</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>æŠ€æœ¯æ ˆï¼š<code>node</code> + <code>express</code> + <code>mongoose</code><br> <a href="https://github.com/chendx97/node-template" target="_blank" rel="noopener noreferrer">gitåœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œå¯ç›´æ¥ä½¿ç”¨ã€‚</p> <h1 id="nodemon-çƒ­æ›´æ–°"><a href="#nodemon-çƒ­æ›´æ–°" class="header-anchor">#</a> nodemon çƒ­æ›´æ–°</h1> <p>ä½¿ç”¨<code>nodemon</code>å¯åŠ¨é¡¹ç›®ï¼Œå¯ä»¥åœ¨ä¿®æ”¹ä»£ç æ—¶ä¸ç”¨é‡æ–°å¯åŠ¨ã€‚</p> <div class="language-bash extra-class"><pre class="language-bash"><code>// å®‰è£…
<span class="token function">npm</span> i nodemon
</code></pre></div><p>å®‰è£…ä¹‹åï¼Œä¿®æ”¹å¯åŠ¨å‘½ä»¤ï¼Œ</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon index.js&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="header-anchor">#</a> ä¸­é—´ä»¶</h1> <h2 id="body-parser"><a href="#body-parser" class="header-anchor">#</a> body-parser</h2> <p><code>body-parser</code>è§£æè¯·æ±‚å‚æ•°ï¼Œä½¿æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>req.body.xx</code>è®¿é—®å‚æ•°ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="cookie-parser"><a href="#cookie-parser" class="header-anchor">#</a> cookie-parser</h2> <p><code>cookie-parser</code>è§£æè¯·æ±‚æºå¸¦çš„<code>cookie</code>ï¼Œä½¿æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>req.cookies</code>è®¿é—®<code>cookie</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> email <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">[</span>config<span class="token punctuation">.</span>cookieName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>email<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">var</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="è·¯ç”±ä¸­é—´ä»¶"><a href="#è·¯ç”±ä¸­é—´ä»¶" class="header-anchor">#</a> è·¯ç”±ä¸­é—´ä»¶</h1> <p>å€ŸåŠ©è·¯ç”±ä¸­é—´ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¼å¼åŒ–æ¥å£è¿”å›å€¼ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// routers/index.js</span>
<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function-variable function">jsonSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">result</span><span class="token operator">:</span> data<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function-variable function">jsonFail</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> message<span class="token punctuation">.</span>message <span class="token operator">||</span> <span class="token string">'æœåŠ¡å™¨å‡ºäº†ç‚¹é—®é¢˜'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre></div><h1 id="mongooseæŒ‡ä»¤"><a href="#mongooseæŒ‡ä»¤" class="header-anchor">#</a> mongooseæŒ‡ä»¤</h1> <h2 id="æŸ¥"><a href="#æŸ¥" class="header-anchor">#</a> æŸ¥</h2> <p><code>find</code>æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼›<br> <code>findOne</code>æŸ¥æ‰¾ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼›<br> <code>findById</code>æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸º<code>id</code>ï¼›</p> <p><code>Model.find(conditions, [projection], [options], [callback])</code></p> <div class="language-js extra-class"><pre class="language-js"><code>model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$gte</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token literal-property property">$lte</span><span class="token operator">:</span><span class="token number">80</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// ageå­—æ®µå¤§äºç­‰äº18ä¸”å°äºç­‰äº80 çš„æ•°æ®</span>
    <span class="token punctuation">{</span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token literal-property property">__v</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// æ•°æ®æ–‡æ¡£ä¸è¿”å›_idå’Œ__vå­—æ®µ</span>
    <span class="token punctuation">{</span><span class="token literal-property property">sort</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token comment">// æ ¹æ®ageå­—æ®µä»¥å¤§åˆ°å°é¡ºåºè¿”å›æ•°æ®æ–‡æ¡£</span>
<span class="token punctuation">)</span>
</code></pre></div><p><code>$gte</code>æ˜¯æ“ä½œç¬¦ï¼Œç±»ä¼¼çš„æ“ä½œç¬¦è¿˜æœ‰ä¸å°‘ï¼š</p> <ul><li><code>$eq</code> ç›¸ç­‰</li> <li><code>$ne</code> ä¸ç›¸ç­‰</li> <li><code>$gt</code> å¤§äº</li> <li><code>$gte</code> å¤§äºç­‰äº</li> <li><code>$lt</code> å°äº</li> <li><code>$lte</code> å°äºç­‰äº</li> <li><code>$in</code> ä¸æ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªåŒ¹é…</li> <li><code>$nin</code> ä¸æ•°ç»„ä¸­æ¯ä¸€ä¸ªéƒ½ä¸åŒ¹é…</li> <li><code>$and</code> æ»¡è¶³æ•°ç»„ä¸­æ‰€æœ‰æ¡ä»¶</li> <li><code>$nor</code> æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³</li> <li><code>$or</code> æ»¡è¶³æ•°ç»„çš„å…¶ä¸­ä¸€ä¸ªæ¡ä»¶</li> <li><code>$not</code> ä¸æ»¡è¶³æ¡ä»¶</li> <li><code>$exists</code> å­˜åœ¨æŒ‡å®šå­—æ®µ</li> <li><code>$type</code> å±äºæŒ‡å®šç±»å‹</li> <li><code>$all</code> åŒ¹é…åŒ…å«æŸ¥è¯¢æ•°ç»„æ‰€æœ‰æ¡ä»¶çš„æ•°ç»„å­—æ®µ</li> <li><code>$elemMatch</code> åŒ¹é…æ•°ç»„å­—æ®µä¸­çš„æŸä¸ªå€¼æ»¡è¶³æŒ‡å®šçš„æ‰€æœ‰æ¡ä»¶</li> <li><code>$size</code> åŒ¹é…æ•°ç»„å­—æ®µçš„<code>length</code> ä¸æŸ¥è¯¢æ¡ä»¶ç›¸åŒ   Same as querySame as query conditions</li></ul> <p><code>projection</code>æŒ‡å®šæŸ¥è¯¢ç»“æœåŒ…å«æˆ–ä¸åŒ…å«å“ªäº›å­—æ®µï¼Œä¹Ÿå¯ä»¥å†™æˆå­—ç¬¦ä¸²ï¼š<code>&quot;-_id -__v&quot;</code>ï¼Œä¸èƒ½åŒ…å«ä¸åŒ…å«åŒæ—¶ä½¿ç”¨ã€‚<br> <code>findOne</code>å’Œ<code>findById</code>çš„åŒºåˆ«åœ¨äº<code>id</code>ä¸º<code>undefined</code>çš„æƒ…å†µï¼Œ<code>findOne({ _id: undefined })</code>è¿”å›ä»»æ„ä¸€æ¡æ•°æ®ï¼Œ<code>findById(undefined)</code>è¿”å›<code>null</code>ã€‚</p> <h2 id="å¢"><a href="#å¢" class="header-anchor">#</a> å¢</h2> <p><code>save([options], [options.safe], [options.validateBeforeSave], [fn])</code>å¢åŠ ä¸€æ¡ï¼Œéœ€è¦å†™å®ä¾‹åŒ–ï¼›<br> <code>Model.create(doc(s), [callback])</code>å¢åŠ ä¸€æ¡æˆ–å¤šæ¡ï¼›<br> <code>Model.insertMany(doc(s), [options], [callback])</code>å¢åŠ å¤šæ¡ï¼›</p> <p><code>save()</code>çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// models/user.js</span>
<span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> UserSchema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> UserModel <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> UserSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> UserModel<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// routers/user.js</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./index.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> User <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../models/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ–°å¢é¡¹ç›®</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/add'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// save</span>
    res<span class="token punctuation">.</span><span class="token function">jsonSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">jsonFail</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre></div><h2 id="åˆ "><a href="#åˆ " class="header-anchor">#</a> åˆ </h2> <p><code>findOneAndDelete</code>æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å¹¶åˆ é™¤ï¼›<br> <code>findByIdAndDelete</code>æŸ¥è¯¢æ¡ä»¶ä¸º<code>id</code>ï¼›<br> <code>deleteMany</code>åˆ é™¤æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ï¼›</p> <p><code>Model.findOneAndDelete(filter, options, callback)</code></p> <h2 id="æ”¹"><a href="#æ”¹" class="header-anchor">#</a> æ”¹</h2> <p><code>findOneAndUpdate</code>å’Œ<code>findByIdAndUpdate</code>éƒ½æ˜¯å…ˆæŸ¥æ‰¾ç„¶åå†ä¿®æ”¹ï¼›<br> <code>updateOne</code>ä¹Ÿæ˜¯æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€æ¡æ•°æ®å¹¶ä¿®æ”¹ï¼›<br> <code>updateMany</code>æ˜¯æ‰¹é‡ä¿®æ”¹æ•°æ®ï¼›</p> <p><code>Model.findOneAndUpdate(filter, update, [options], [callback])</code></p> <p>ä¸¾ä¸ªä¾‹å­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">_id</span><span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>id
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">pass</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><h1 id="è§£æexcelæ–‡ä»¶"><a href="#è§£æexcelæ–‡ä»¶" class="header-anchor">#</a> è§£æexcelæ–‡ä»¶</h1> <p>ä½¿ç”¨<code>multer</code>è§£æform-dataæ•°æ®ï¼Œ<a href="https://www.npmjs.com/package/multer" target="_blank" rel="noopener noreferrer">npmåœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚<br>
ä½¿ç”¨<code>node-xlsx</code>è§£æexcelï¼Œ<a href="https://www.npmjs.com/package/node-xlsx" target="_blank" rel="noopener noreferrer">npmåœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> xlsx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-xlsx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sheets <span class="token operator">=</span> xlsx<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../test.xlsx'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> sheets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span> <span class="token comment">// äºŒç»´æ•°ç»„</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä½¿ç”¨<code>req.file.mimetype</code>å¯ä»¥è·å–æ–‡ä»¶çš„<code>MIME type</code>ï¼Œå¯ä»¥ä»¥æ­¤æ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œ<code>excel</code>æ–‡ä»¶çš„<code>MIME type</code>æ˜¯<code>application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</code>æˆ–<code>application/vnd.ms-excel</code>ã€‚</p> <h1 id="ä¸‹è½½æ–‡ä»¶æ¥å£"><a href="#ä¸‹è½½æ–‡ä»¶æ¥å£" class="header-anchor">#</a> ä¸‹è½½æ–‡ä»¶æ¥å£</h1> <p>ä½¿ç”¨<code>sendFile</code>å¯ä»¥ç›´æ¥è¿”å›æ–‡ä»¶ç±»å‹æ•°æ®ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/download'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../test.xlsx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">jsonFail</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">handleDownload</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/download'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">saveAs</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> <span class="token string">'test.xlsx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="dockeréƒ¨ç½²é…ç½®"><a href="#dockeréƒ¨ç½²é…ç½®" class="header-anchor">#</a> dockeréƒ¨ç½²é…ç½®</h1> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Dockefileæ–‡ä»¶</span>

<span class="token comment"># ä½¿ç”¨Node.jsçš„å®˜æ–¹é•œåƒä½œä¸ºåŸºç¡€ </span>
FROM node:14 

<span class="token comment"># åœ¨å®¹å™¨ä¸­åˆ›å»ºä¸€ä¸ªå·¥ä½œç›®å½• </span>
WORKDIR /app 

<span class="token comment"># å¤åˆ¶åº”ç”¨ç¨‹åºæ–‡ä»¶åˆ°å®¹å™¨ä¸­ </span>
COPY package*.json ./ 

<span class="token comment"># å®‰è£…ä¾èµ–é¡¹ </span>
RUN <span class="token function">npm</span> <span class="token function">install</span> 

<span class="token comment"># å¤åˆ¶åº”ç”¨ç¨‹åºä»£ç åˆ°å®¹å™¨ä¸­ </span>
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> 

<span class="token comment"># æš´éœ²å®¹å™¨çš„ç«¯å£ </span>
EXPOSE <span class="token number">3000</span> 

<span class="token comment"># å®šä¹‰å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ </span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;npm&quot;</span>, <span class="token string">&quot;start&quot;</span><span class="token punctuation">]</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/node/post-502.html" class="prev">
        ä¸ºä»€ä¹ˆåªè¿™ä¸€ä¸ªæ¥å£502å‘¢ï¼Ÿ
      </a></span> <span class="next"><a href="/blog/deploy/nginx-autoindex-auth.html">
        ç›®å½•æµè§ˆ&amp;æƒé™æ ¡éªŒ
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.f0df7f2e.js" defer></script><script src="/blog/assets/js/2.0c4bddf9.js" defer></script><script src="/blog/assets/js/1.50b457b8.js" defer></script><script src="/blog/assets/js/44.01594bf5.js" defer></script>
  </body>
</html>
